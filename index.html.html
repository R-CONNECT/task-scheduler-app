<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Smart Task Manager - 持続可能なタスク・スケジュール管理</title>
    <meta name="description" content="アイゼンハワー・マトリックス、ポモドーロ・テクニック、カンバン方式を統合したスマートなタスク管理アプリ">
    <meta name="keywords" content="タスク管理,スケジュール,ポモドーロ,アイゼンハワー,カンバン,生産性">
    <meta name="author" content="Smart Task Manager">
    
    <!-- PWA Manifest -->
    <link rel="manifest" href="data:application/json;base64,eyJuYW1lIjoiU21hcnQgVGFzayBNYW5hZ2VyIiwic2hvcnRfbmFtZSI6IlRhc2tNZ3IiLCJzdGFydF91cmwiOiIuLyIsImRpc3BsYXkiOiJzdGFuZGFsb25lIiwiYmFja2dyb3VuZF9jb2xvciI6IiNmZmZmZmYiLCJ0aGVtZV9jb2xvciI6IiMzYjgyZjYiLCJpY29ucyI6W3sic3JjIjoiZGF0YTppbWFnZS9zdmcreG1sO2Jhc2U2NCxQSE4yWnlCM2FXUjBhRDBpTVRJNElpQm9aV2xuYUhROUlqRXlPQ0lpSUhabGNuTnBiMjQ5SWpFdU1TNHdJaUI0Yld4dWN6MGlhSFIwY0RvdkwzZDNkeTUzTXk1dmNtY3ZNakF3TUM5emRtY2lQZ29nSUNBZ1BHTnBjbU5zWlNCamVEMGlOalFpSUdONVBTSTJOQ0lpSUhJOUlqTXdJaUJtYVd4c1BTSWpNMkk0TW1ZMklpOCtDaUFnSUNBOGRHVjRkQ0I0UFNJMk5DSWdlVDBpTnpRaUlIUmxlSFF0WVc1amFHOXlQU0p0YVdSa2JHVWlJR1pwYkd3OUlpTm1abVptWm1ZaVBrMVBQQzkwWlhoMFBnbzhMM04yWno0PSIsInNpemVzIjoiMTI4eDEyOCIsInR5cGUiOiJpbWFnZS9zdmcreG1sIn1dfQ==">
    <meta name="theme-color" content="#3b82f6">
    <link rel="apple-touch-icon" href="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTI4IiBoZWlnaHQ9IjEyOCIgdmVyc2lvbj0iMS4xLjAiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CiAgICA8Y2lyY2xlIGN4PSI2NCIgY3k9IjY0IiByPSIzMCIgZmlsbD0iIzNiODJmNiIvPgogICAgPHRleHQgeD0iNjQiIHk9Ijc0IiB0ZXh0LWFuY2hvcj0ibWlkZGxlIiBmaWxsPSIjZmZmZmZmIj5NT1A8L3RleHQ+Cjwvc3ZnPg==">
    
    <!-- OG Tags -->
    <meta property="og:title" content="Smart Task Manager">
    <meta property="og:description" content="アイゼンハワー・マトリックス、ポモドーロ・テクニック、カンバン方式を統合したスマートなタスク管理アプリ">
    <meta property="og:type" content="website">
    
    <!-- CSS Libraries -->
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.0/css/all.min.css">
    
    <!-- Custom Styles -->
    <style>
        .timer-circle {
            transition: stroke-dashoffset 1s linear;
        }
        .glassmorphism {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        .task-card {
            transition: transform 0.2s ease, box-shadow 0.2s ease;
        }
        .task-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
        }
        .calendar-cell {
            min-height: 100px;
            position: relative;
        }
        .calendar-cell.has-tasks {
            background: linear-gradient(45deg, #e3f2fd, #f3e5f5);
        }
        .priority-high { border-left: 4px solid #ef4444; }
        .priority-medium { border-left: 4px solid #f59e0b; }
        .priority-low { border-left: 4px solid #10b981; }
        .urgency-high { background: rgba(239, 68, 68, 0.1); }
        .urgency-medium { background: rgba(245, 158, 11, 0.1); }
        .urgency-low { background: rgba(16, 185, 129, 0.1); }
        .kanban-column {
            min-height: 400px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        .kanban-card {
            background: white;
            border-radius: 8px;
            padding: 12px;
            margin-bottom: 8px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            cursor: move;
        }
        .matrix-quadrant {
            min-height: 200px;
            border: 2px dashed #e5e7eb;
            border-radius: 8px;
            padding: 16px;
            transition: all 0.3s ease;
        }
        .matrix-quadrant:hover {
            border-color: #3b82f6;
            background: rgba(59, 130, 246, 0.05);
        }
        .matrix-urgent-important { border-color: #ef4444; background: rgba(239, 68, 68, 0.05); }
        .matrix-important-not-urgent { border-color: #f59e0b; background: rgba(245, 158, 11, 0.05); }
        .matrix-urgent-not-important { border-color: #8b5cf6; background: rgba(139, 92, 246, 0.05); }
        .matrix-not-urgent-not-important { border-color: #6b7280; background: rgba(107, 114, 128, 0.05); }
        .pomodoro-timer {
            background: linear-gradient(45deg, #ff6b6b, #ffa726);
            color: white;
            border-radius: 50%;
            width: 200px;
            height: 200px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2rem;
            font-weight: bold;
            position: relative;
            margin: 0 auto;
        }
        .schedule-item {
            padding: 8px 12px;
            margin: 4px 0;
            border-radius: 6px;
            border-left: 4px solid #3b82f6;
            background: rgba(59, 130, 246, 0.1);
            cursor: pointer;
            transition: all 0.2s ease;
        }
        .schedule-item:hover {
            background: rgba(59, 130, 246, 0.2);
            transform: translateX(4px);
        }
        .schedule-item.completed {
            opacity: 0.6;
            text-decoration: line-through;
        }
        .calendar-nav {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }
        .calendar-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 1px;
            background: #e5e7eb;
            border: 1px solid #e5e7eb;
        }
        .calendar-header {
            background: #374151;
            color: white;
            padding: 12px;
            text-align: center;
            font-weight: bold;
        }
        .calendar-day {
            background: white;
            padding: 8px;
            min-height: 80px;
            border: 1px solid #e5e7eb;
            position: relative;
        }
        .calendar-day.other-month {
            background: #f9fafb;
            color: #9ca3af;
        }
        .calendar-day.today {
            background: #dbeafe;
            border-color: #3b82f6;
        }
        .task-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: #3b82f6;
            display: inline-block;
            margin: 1px;
        }
        .year-month {
            display: inline-block;
            width: 250px;
            margin: 10px;
            padding: 15px;
            border: 1px solid #e5e7eb;
            border-radius: 8px;
            background: white;
        }
        .year-month-header {
            text-align: center;
            font-weight: bold;
            margin-bottom: 10px;
            color: #374151;
        }
        .year-calendar-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 2px;
            font-size: 0.75rem;
        }
        .year-calendar-day {
            padding: 2px;
            text-align: center;
            border: 1px solid #f3f4f6;
        }
        .year-calendar-day.has-task {
            background: #3b82f6;
            color: white;
            border-radius: 2px;
        }
        @media (max-width: 768px) {
            .year-month {
                width: 100%;
                margin: 5px 0;
            }
            .pomodoro-timer {
                width: 150px;
                height: 150px;
                font-size: 1.5rem;
            }
            .matrix-quadrant {
                min-height: 150px;
            }
        }
    </style>
</head>
<body class="bg-gray-50 min-h-screen">
    <!-- Navigation -->
    <nav class="bg-white shadow-sm border-b">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between items-center h-16">
                <div class="flex items-center">
                    <i class="fas fa-tasks text-2xl text-blue-600 mr-3"></i>
                    <h1 class="text-xl font-bold text-gray-900">Smart Task Manager</h1>
                </div>
                <div class="flex space-x-4">
                    <button onclick="showTab('dashboard')" class="nav-btn px-4 py-2 text-sm font-medium text-gray-700 hover:text-blue-600 transition-colors">
                        <i class="fas fa-tachometer-alt mr-2"></i>ダッシュボード
                    </button>
                    <button onclick="showTab('matrix')" class="nav-btn px-4 py-2 text-sm font-medium text-gray-700 hover:text-blue-600 transition-colors">
                        <i class="fas fa-th mr-2"></i>マトリックス
                    </button>
                    <button onclick="showTab('kanban')" class="nav-btn px-4 py-2 text-sm font-medium text-gray-700 hover:text-blue-600 transition-colors">
                        <i class="fas fa-columns mr-2"></i>カンバン
                    </button>
                    <button onclick="showTab('pomodoro')" class="nav-btn px-4 py-2 text-sm font-medium text-gray-700 hover:text-blue-600 transition-colors">
                        <i class="fas fa-clock mr-2"></i>ポモドーロ
                    </button>
                    <button onclick="showTab('schedule')" class="nav-btn px-4 py-2 text-sm font-medium text-gray-700 hover:text-blue-600 transition-colors">
                        <i class="fas fa-calendar mr-2"></i>スケジュール
                    </button>
                </div>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
        
        <!-- Dashboard Tab -->
        <div id="dashboard" class="tab-content">
            <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                <!-- Task Creation -->
                <div class="lg:col-span-2 bg-white rounded-lg shadow-sm p-6">
                    <h2 class="text-lg font-semibold mb-4 flex items-center">
                        <i class="fas fa-plus-circle text-green-600 mr-2"></i>新しいタスク作成
                    </h2>
                    <form id="taskForm" class="space-y-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">タスク名 *</label>
                            <input type="text" id="taskName" required class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="タスクを入力してください">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">説明</label>
                            <textarea id="taskDescription" rows="3" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="詳細説明（任意）"></textarea>
                        </div>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">実行日</label>
                                <input type="date" id="taskDate" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">時間</label>
                                <input type="time" id="taskTime" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                            </div>
                        </div>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">重要度</label>
                                <select id="taskImportance" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                                    <option value="high">高</option>
                                    <option value="medium" selected>中</option>
                                    <option value="low">低</option>
                                </select>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">緊急度</label>
                                <select id="taskUrgency" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                                    <option value="high">高</option>
                                    <option value="medium" selected>中</option>
                                    <option value="low">低</option>
                                </select>
                            </div>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">アラート設定</label>
                            <select id="taskAlert" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                                <option value="none">なし</option>
                                <option value="1hour">1時間前</option>
                                <option value="1day">1日前</option>
                                <option value="1week">1週間前</option>
                            </select>
                        </div>
                        <button type="submit" class="w-full bg-blue-600 text-white py-2 px-4 rounded-md hover:bg-blue-700 transition-colors">
                            <i class="fas fa-plus mr-2"></i>タスクを追加
                        </button>
                    </form>

                    <!-- Export Section -->
                    <div class="mt-8 pt-6 border-t border-gray-200">
                        <h3 class="text-md font-semibold mb-3 flex items-center">
                            <i class="fas fa-download text-blue-600 mr-2"></i>Googleカレンダーエクスポート
                        </h3>
                        <div class="flex space-x-4">
                            <button onclick="exportCSV()" class="flex-1 bg-green-600 text-white py-2 px-4 rounded-md hover:bg-green-700 transition-colors">
                                <i class="fas fa-file-csv mr-2"></i>CSV形式でダウンロード
                            </button>
                            <button onclick="exportICS()" class="flex-1 bg-purple-600 text-white py-2 px-4 rounded-md hover:bg-purple-700 transition-colors">
                                <i class="fas fa-calendar-alt mr-2"></i>ICS形式でダウンロード
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Progress Overview -->
                <div class="space-y-6">
                    <div class="bg-white rounded-lg shadow-sm p-6">
                        <h3 class="text-lg font-semibold mb-4 flex items-center">
                            <i class="fas fa-chart-pie text-purple-600 mr-2"></i>進捗状況
                        </h3>
                        <div class="space-y-4">
                            <div class="flex justify-between items-center">
                                <span class="text-sm text-gray-600">完了タスク</span>
                                <span id="completedCount" class="text-lg font-semibold text-green-600">0</span>
                            </div>
                            <div class="flex justify-between items-center">
                                <span class="text-sm text-gray-600">進行中タスク</span>
                                <span id="inProgressCount" class="text-lg font-semibold text-blue-600">0</span>
                            </div>
                            <div class="flex justify-between items-center">
                                <span class="text-sm text-gray-600">未着手タスク</span>
                                <span id="todoCount" class="text-lg font-semibold text-gray-600">0</span>
                            </div>
                            <div class="w-full bg-gray-200 rounded-full h-2">
                                <div id="progressBar" class="bg-blue-600 h-2 rounded-full transition-all duration-300" style="width: 0%"></div>
                            </div>
                        </div>
                    </div>

                    <div class="bg-white rounded-lg shadow-sm p-6">
                        <h3 class="text-lg font-semibold mb-4 flex items-center">
                            <i class="fas fa-calendar-day text-blue-600 mr-2"></i>今日の予定
                        </h3>
                        <div id="todayTasks" class="space-y-2">
                            <p class="text-gray-500 text-sm">今日の予定はありません</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Matrix Tab -->
        <div id="matrix" class="tab-content hidden">
            <div class="bg-white rounded-lg shadow-sm p-6">
                <h2 class="text-lg font-semibold mb-6 flex items-center">
                    <i class="fas fa-th text-blue-600 mr-2"></i>アイゼンハワー・マトリックス
                </h2>
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                    <!-- Quadrant 1: Urgent & Important -->
                    <div class="matrix-quadrant matrix-urgent-important">
                        <h3 class="font-semibold text-red-700 mb-3 flex items-center">
                            <i class="fas fa-exclamation-triangle mr-2"></i>緊急かつ重要
                        </h3>
                        <p class="text-sm text-gray-600 mb-4">すぐに対応が必要なタスク</p>
                        <div id="quadrant1" class="space-y-2"></div>
                    </div>
                    
                    <!-- Quadrant 2: Not Urgent but Important -->
                    <div class="matrix-quadrant matrix-important-not-urgent">
                        <h3 class="font-semibold text-yellow-700 mb-3 flex items-center">
                            <i class="fas fa-star mr-2"></i>重要だが緊急でない
                        </h3>
                        <p class="text-sm text-gray-600 mb-4">計画的に取り組むべきタスク</p>
                        <div id="quadrant2" class="space-y-2"></div>
                    </div>
                    
                    <!-- Quadrant 3: Urgent but Not Important -->
                    <div class="matrix-quadrant matrix-urgent-not-important">
                        <h3 class="font-semibold text-purple-700 mb-3 flex items-center">
                            <i class="fas fa-share mr-2"></i>緊急だが重要でない
                        </h3>
                        <p class="text-sm text-gray-600 mb-4">委任を検討すべきタスク</p>
                        <div id="quadrant3" class="space-y-2"></div>
                    </div>
                    
                    <!-- Quadrant 4: Not Urgent & Not Important -->
                    <div class="matrix-quadrant matrix-not-urgent-not-important">
                        <h3 class="font-semibold text-gray-700 mb-3 flex items-center">
                            <i class="fas fa-trash mr-2"></i>緊急でも重要でもない
                        </h3>
                        <p class="text-sm text-gray-600 mb-4">排除を検討すべきタスク</p>
                        <div id="quadrant4" class="space-y-2"></div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Kanban Tab -->
        <div id="kanban" class="tab-content hidden">
            <div class="bg-white rounded-lg shadow-sm p-6">
                <h2 class="text-lg font-semibold mb-6 flex items-center">
                    <i class="fas fa-columns text-blue-600 mr-2"></i>カンバン方式進捗管理
                </h2>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                    <!-- TODO Column -->
                    <div class="kanban-column rounded-lg p-4">
                        <h3 class="font-semibold text-white mb-4 flex items-center">
                            <i class="fas fa-list mr-2"></i>未着手
                        </h3>
                        <div id="kanban-todo" class="space-y-2 min-h-32"></div>
                    </div>
                    
                    <!-- In Progress Column -->
                    <div class="kanban-column rounded-lg p-4">
                        <h3 class="font-semibold text-white mb-4 flex items-center">
                            <i class="fas fa-cog mr-2"></i>進行中
                        </h3>
                        <div id="kanban-progress" class="space-y-2 min-h-32"></div>
                    </div>
                    
                    <!-- Done Column -->
                    <div class="kanban-column rounded-lg p-4">
                        <h3 class="font-semibold text-white mb-4 flex items-center">
                            <i class="fas fa-check mr-2"></i>完了
                        </h3>
                        <div id="kanban-done" class="space-y-2 min-h-32"></div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Pomodoro Tab -->
        <div id="pomodoro" class="tab-content hidden">
            <div class="bg-white rounded-lg shadow-sm p-6">
                <h2 class="text-lg font-semibold mb-6 flex items-center">
                    <i class="fas fa-clock text-red-600 mr-2"></i>ポモドーロ・タイマー
                </h2>
                <div class="text-center space-y-6">
                    <div class="pomodoro-timer">
                        <div id="pomodoroDisplay">25:00</div>
                        <svg class="absolute top-0 left-0 w-full h-full" style="transform: rotate(-90deg)">
                            <circle cx="100" cy="100" r="90" fill="none" stroke="rgba(255,255,255,0.3)" stroke-width="4"/>
                            <circle id="pomodoroCircle" cx="100" cy="100" r="90" fill="none" stroke="white" stroke-width="4" 
                                    stroke-linecap="round" stroke-dasharray="565.48" stroke-dashoffset="565.48" class="timer-circle"/>
                        </svg>
                    </div>
                    
                    <div class="flex justify-center space-x-4">
                        <button id="pomodoroStart" onclick="startPomodoro()" class="bg-green-600 text-white px-6 py-2 rounded-md hover:bg-green-700 transition-colors">
                            <i class="fas fa-play mr-2"></i>開始
                        </button>
                        <button id="pomodoroPause" onclick="pausePomodoro()" class="bg-yellow-600 text-white px-6 py-2 rounded-md hover:bg-yellow-700 transition-colors" disabled>
                            <i class="fas fa-pause mr-2"></i>一時停止
                        </button>
                        <button id="pomodoroReset" onclick="resetPomodoro()" class="bg-gray-600 text-white px-6 py-2 rounded-md hover:bg-gray-700 transition-colors">
                            <i class="fas fa-stop mr-2"></i>リセット
                        </button>
                    </div>
                    
                    <div class="bg-gray-100 p-4 rounded-lg">
                        <h3 class="font-semibold mb-2">本日の統計</h3>
                        <div class="grid grid-cols-2 gap-4 text-sm">
                            <div>完了サイクル: <span id="completedCycles" class="font-semibold">0</span></div>
                            <div>集中時間: <span id="focusTime" class="font-semibold">0分</span></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Schedule Tab -->
        <div id="schedule" class="tab-content hidden">
            <div class="bg-white rounded-lg shadow-sm p-6">
                <div class="flex flex-wrap items-center justify-between mb-6">
                    <h2 class="text-lg font-semibold flex items-center">
                        <i class="fas fa-calendar text-blue-600 mr-2"></i>スケジュール
                    </h2>
                    <div class="flex space-x-2">
                        <button onclick="showScheduleView('day')" class="schedule-view-btn px-4 py-2 text-sm bg-blue-600 text-white rounded-md hover:bg-blue-700 transition-colors">
                            <i class="fas fa-calendar-day mr-1"></i>日
                        </button>
                        <button onclick="showScheduleView('week')" class="schedule-view-btn px-4 py-2 text-sm bg-gray-200 text-gray-700 rounded-md hover:bg-gray-300 transition-colors">
                            <i class="fas fa-calendar-week mr-1"></i>週間
                        </button>
                        <button onclick="showScheduleView('month')" class="schedule-view-btn px-4 py-2 text-sm bg-gray-200 text-gray-700 rounded-md hover:bg-gray-300 transition-colors">
                            <i class="fas fa-calendar-alt mr-1"></i>月間
                        </button>
                        <button onclick="showScheduleView('year')" class="schedule-view-btn px-4 py-2 text-sm bg-gray-200 text-gray-700 rounded-md hover:bg-gray-300 transition-colors">
                            <i class="fas fa-calendar mr-1"></i>年間
                        </button>
                    </div>
                </div>

                <!-- Day View -->
                <div id="dayView" class="schedule-view">
                    <div class="calendar-nav">
                        <button onclick="previousDay()" class="p-2 rounded-md bg-gray-200 hover:bg-gray-300 transition-colors">
                            <i class="fas fa-chevron-left"></i>
                        </button>
                        <h3 id="dayTitle" class="text-lg font-semibold"></h3>
                        <button onclick="nextDay()" class="p-2 rounded-md bg-gray-200 hover:bg-gray-300 transition-colors">
                            <i class="fas fa-chevron-right"></i>
                        </button>
                    </div>
                    <div id="daySchedule" class="space-y-2"></div>
                </div>

                <!-- Week View -->
                <div id="weekView" class="schedule-view hidden">
                    <div class="calendar-nav">
                        <button onclick="previousWeek()" class="p-2 rounded-md bg-gray-200 hover:bg-gray-300 transition-colors">
                            <i class="fas fa-chevron-left"></i>
                        </button>
                        <h3 id="weekTitle" class="text-lg font-semibold"></h3>
                        <button onclick="nextWeek()" class="p-2 rounded-md bg-gray-200 hover:bg-gray-300 transition-colors">
                            <i class="fas fa-chevron-right"></i>
                        </button>
                    </div>
                    <div id="weekSchedule" class="grid grid-cols-7 gap-1 mt-4"></div>
                </div>

                <!-- Month View -->
                <div id="monthView" class="schedule-view hidden">
                    <div class="calendar-nav">
                        <button onclick="previousMonth()" class="p-2 rounded-md bg-gray-200 hover:bg-gray-300 transition-colors">
                            <i class="fas fa-chevron-left"></i>
                        </button>
                        <h3 id="monthTitle" class="text-lg font-semibold"></h3>
                        <button onclick="nextMonth()" class="p-2 rounded-md bg-gray-200 hover:bg-gray-300 transition-colors">
                            <i class="fas fa-chevron-right"></i>
                        </button>
                    </div>
                    <div class="calendar-grid mt-4">
                        <div class="calendar-header">日</div>
                        <div class="calendar-header">月</div>
                        <div class="calendar-header">火</div>
                        <div class="calendar-header">水</div>
                        <div class="calendar-header">木</div>
                        <div class="calendar-header">金</div>
                        <div class="calendar-header">土</div>
                        <div id="monthCalendar"></div>
                    </div>
                </div>

                <!-- Year View -->
                <div id="yearView" class="schedule-view hidden">
                    <div class="calendar-nav">
                        <button onclick="previousYear()" class="p-2 rounded-md bg-gray-200 hover:bg-gray-300 transition-colors">
                            <i class="fas fa-chevron-left"></i>
                        </button>
                        <h3 id="yearTitle" class="text-lg font-semibold"></h3>
                        <button onclick="nextYear()" class="p-2 rounded-md bg-gray-200 hover:bg-gray-300 transition-colors">
                            <i class="fas fa-chevron-right"></i>
                        </button>
                    </div>
                    <div id="yearCalendar" class="flex flex-wrap justify-center mt-4"></div>
                </div>
            </div>
        </div>
    </main>

    <!-- Install Prompt -->
    <div id="installPrompt" class="fixed bottom-4 right-4 bg-blue-600 text-white p-4 rounded-lg shadow-lg hidden">
        <div class="flex items-center space-x-3">
            <i class="fas fa-download"></i>
            <span>アプリをインストール</span>
            <button onclick="installApp()" class="bg-white text-blue-600 px-3 py-1 rounded text-sm">インストール</button>
            <button onclick="dismissInstall()" class="text-white hover:text-gray-300">×</button>
        </div>
    </div>

    <!-- JavaScript Libraries -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <!-- Main JavaScript -->
    <script>
        // Global variables
        let tasks = JSON.parse(localStorage.getItem('tasks')) || [];
        let currentDate = new Date();
        let pomodoroTimer = null;
        let pomodoroTimeLeft = 25 * 60; // 25 minutes in seconds
        let pomodoroActive = false;
        let pomodoroStats = JSON.parse(localStorage.getItem('pomodoroStats')) || { completedCycles: 0, focusTime: 0 };
        let deferredPrompt;

        // Initialize app
        document.addEventListener('DOMContentLoaded', function() {
            loadTasks();
            updateDashboard();
            updateMatrix();
            updateKanban();
            updateSchedule();
            updatePomodoroStats();
            showTab('dashboard');
            
            // Set today's date as default
            document.getElementById('taskDate').value = new Date().toISOString().split('T')[0];
            
            // PWA install prompt
            window.addEventListener('beforeinstallprompt', (e) => {
                e.preventDefault();
                deferredPrompt = e;
                document.getElementById('installPrompt').classList.remove('hidden');
            });
        });

        // Service Worker registration
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.register('/sw.js').catch(console.error);
        }

        // PWA install functions
        function installApp() {
            if (deferredPrompt) {
                deferredPrompt.prompt();
                deferredPrompt.userChoice.then((choiceResult) => {
                    if (choiceResult.outcome === 'accepted') {
                        document.getElementById('installPrompt').classList.add('hidden');
                    }
                    deferredPrompt = null;
                });
            }
        }

        function dismissInstall() {
            document.getElementById('installPrompt').classList.add('hidden');
        }

        // Tab management
        function showTab(tabName) {
            // Hide all tabs
            document.querySelectorAll('.tab-content').forEach(tab => tab.classList.add('hidden'));
            // Show selected tab
            document.getElementById(tabName).classList.remove('hidden');
            
            // Update navigation
            document.querySelectorAll('.nav-btn').forEach(btn => btn.classList.remove('text-blue-600', 'bg-blue-50'));
            event.target.classList.add('text-blue-600', 'bg-blue-50');
            
            // Update content based on tab
            if (tabName === 'schedule') {
                updateSchedule();
            } else if (tabName === 'matrix') {
                updateMatrix();
            } else if (tabName === 'kanban') {
                updateKanban();
            }
        }

        // Task management
        document.getElementById('taskForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const task = {
                id: Date.now(),
                name: document.getElementById('taskName').value,
                description: document.getElementById('taskDescription').value,
                date: document.getElementById('taskDate').value,
                time: document.getElementById('taskTime').value,
                importance: document.getElementById('taskImportance').value,
                urgency: document.getElementById('taskUrgency').value,
                alert: document.getElementById('taskAlert').value,
                status: 'todo',
                completed: false,
                createdAt: new Date().toISOString()
            };
            
            tasks.push(task);
            saveTasks();
            updateDashboard();
            updateMatrix();
            updateKanban();
            updateSchedule();
            
            // Reset form
            document.getElementById('taskForm').reset();
            document.getElementById('taskDate').value = new Date().toISOString().split('T')[0];
            
            // Show success message
            showNotification('タスクが追加されました', 'success');
        });

        function saveTasks() {
            localStorage.setItem('tasks', JSON.stringify(tasks));
        }

        function loadTasks() {
            const savedTasks = localStorage.getItem('tasks');
            if (savedTasks) {
                tasks = JSON.parse(savedTasks);
            }
        }

        function deleteTask(taskId) {
            tasks = tasks.filter(task => task.id !== taskId);
            saveTasks();
            updateDashboard();
            updateMatrix();
            updateKanban();
            updateSchedule();
            showNotification('タスクが削除されました', 'info');
        }

        function toggleTaskComplete(taskId) {
            const task = tasks.find(t => t.id === taskId);
            if (task) {
                task.completed = !task.completed;
                task.status = task.completed ? 'done' : 'todo';
                saveTasks();
                updateDashboard();
                updateMatrix();
                updateKanban();
                updateSchedule();
            }
        }

        function changeTaskStatus(taskId, newStatus) {
            const task = tasks.find(t => t.id === taskId);
            if (task) {
                task.status = newStatus;
                task.completed = newStatus === 'done';
                saveTasks();
                updateDashboard();
                updateMatrix();
                updateKanban();
                updateSchedule();
            }
        }

        // Dashboard updates
        function updateDashboard() {
            const completedTasks = tasks.filter(task => task.completed).length;
            const inProgressTasks = tasks.filter(task => task.status === 'progress').length;
            const todoTasks = tasks.filter(task => task.status === 'todo').length;
            const totalTasks = tasks.length;
            
            document.getElementById('completedCount').textContent = completedTasks;
            document.getElementById('inProgressCount').textContent = inProgressTasks;
            document.getElementById('todoCount').textContent = todoTasks;
            
            const progressPercentage = totalTasks > 0 ? (completedTasks / totalTasks) * 100 : 0;
            document.getElementById('progressBar').style.width = progressPercentage + '%';
            
            // Update today's tasks
            updateTodayTasks();
        }

        function updateTodayTasks() {
            const today = new Date().toISOString().split('T')[0];
            const todayTasks = tasks.filter(task => task.date === today);
            const container = document.getElementById('todayTasks');
            
            if (todayTasks.length === 0) {
                container.innerHTML = '<p class="text-gray-500 text-sm">今日の予定はありません</p>';
                return;
            }
            
            container.innerHTML = todayTasks.map(task => `
                <div class="schedule-item ${task.completed ? 'completed' : ''}" onclick="toggleTaskComplete(${task.id})">
                    <div class="flex items-center justify-between">
                        <div class="flex items-center space-x-2">
                            <input type="checkbox" ${task.completed ? 'checked' : ''} class="rounded">
                            <span class="font-medium">${task.name}</span>
                        </div>
                        <span class="text-sm text-gray-500">${task.time || '時間未設定'}</span>
                    </div>
                    ${task.description ? `<p class="text-sm text-gray-600 mt-1">${task.description}</p>` : ''}
                </div>
            `).join('');
        }

        // Matrix updates
        function updateMatrix() {
            const quadrants = {
                1: tasks.filter(t => t.urgency === 'high' && t.importance === 'high'),
                2: tasks.filter(t => t.urgency === 'low' && t.importance === 'high'),
                3: tasks.filter(t => t.urgency === 'high' && t.importance === 'low'),
                4: tasks.filter(t => t.urgency === 'low' && t.importance === 'low')
            };
            
            Object.keys(quadrants).forEach(quadrant => {
                const container = document.getElementById(`quadrant${quadrant}`);
                container.innerHTML = quadrants[quadrant].map(task => `
                    <div class="task-card p-3 bg-white rounded-lg shadow-sm border-l-4 ${getPriorityClass(task.importance)} ${getUrgencyClass(task.urgency)}">
                        <div class="flex items-center justify-between">
                            <h4 class="font-medium text-sm">${task.name}</h4>
                            <div class="flex space-x-1">
                                <button onclick="toggleTaskComplete(${task.id})" class="text-green-600 hover:text-green-800">
                                    <i class="fas fa-check text-xs"></i>
                                </button>
                                <button onclick="deleteTask(${task.id})" class="text-red-600 hover:text-red-800">
                                    <i class="fas fa-trash text-xs"></i>
                                </button>
                            </div>
                        </div>
                        ${task.description ? `<p class="text-xs text-gray-600 mt-1">${task.description}</p>` : ''}
                        <div class="text-xs text-gray-500 mt-2">
                            ${task.date ? new Date(task.date).toLocaleDateString('ja-JP') : '日付未設定'}
                            ${task.time ? ` ${task.time}` : ''}
                        </div>
                    </div>
                `).join('');
            });
        }

        // Kanban updates
        function updateKanban() {
            const columns = {
                'todo': document.getElementById('kanban-todo'),
                'progress': document.getElementById('kanban-progress'),
                'done': document.getElementById('kanban-done')
            };
            
            Object.keys(columns).forEach(status => {
                const tasksInColumn = tasks.filter(task => task.status === status);
                columns[status].innerHTML = tasksInColumn.map(task => `
                    <div class="kanban-card">
                        <div class="flex items-center justify-between mb-2">
                            <h4 class="font-medium text-sm">${task.name}</h4>
                            <div class="flex space-x-1">
                                ${status !== 'todo' ? `<button onclick="changeTaskStatus(${task.id}, 'todo')" class="text-gray-600 hover:text-gray-800"><i class="fas fa-arrow-left text-xs"></i></button>` : ''}
                                ${status !== 'progress' ? `<button onclick="changeTaskStatus(${task.id}, 'progress')" class="text-blue-600 hover:text-blue-800"><i class="fas fa-play text-xs"></i></button>` : ''}
                                ${status !== 'done' ? `<button onclick="changeTaskStatus(${task.id}, 'done')" class="text-green-600 hover:text-green-800"><i class="fas fa-check text-xs"></i></button>` : ''}
                                <button onclick="deleteTask(${task.id})" class="text-red-600 hover:text-red-800"><i class="fas fa-trash text-xs"></i></button>
                            </div>
                        </div>
                        ${task.description ? `<p class="text-xs text-gray-600 mb-2">${task.description}</p>` : ''}
                        <div class="text-xs text-gray-500">
                            ${task.date ? new Date(task.date).toLocaleDateString('ja-JP') : '日付未設定'}
                            ${task.time ? ` ${task.time}` : ''}
                        </div>
                        <div class="flex space-x-2 mt-2">
                            <span class="px-2 py-1 text-xs rounded ${getImportanceBadge(task.importance)}">${getImportanceLabel(task.importance)}</span>
                            <span class="px-2 py-1 text-xs rounded ${getUrgencyBadge(task.urgency)}">${getUrgencyLabel(task.urgency)}</span>
                        </div>
                    </div>
                `).join('');
            });
        }

        // Schedule management
        function showScheduleView(view) {
            // Hide all views
            document.querySelectorAll('.schedule-view').forEach(v => v.classList.add('hidden'));
            // Show selected view
            document.getElementById(view + 'View').classList.remove('hidden');
            
            // Update button styles
            document.querySelectorAll('.schedule-view-btn').forEach(btn => {
                btn.classList.remove('bg-blue-600', 'text-white');
                btn.classList.add('bg-gray-200', 'text-gray-700');
            });
            event.target.classList.remove('bg-gray-200', 'text-gray-700');
            event.target.classList.add('bg-blue-600', 'text-white');
            
            // Update the specific view
            if (view === 'day') updateDayView();
            else if (view === 'week') updateWeekView();
            else if (view === 'month') updateMonthView();
            else if (view === 'year') updateYearView();
        }

        function updateSchedule() {
            updateDayView();
            updateWeekView();
            updateMonthView();
            updateYearView();
        }

        function updateDayView() {
            const dateStr = currentDate.toISOString().split('T')[0];
            document.getElementById('dayTitle').textContent = currentDate.toLocaleDateString('ja-JP', {
                year: 'numeric',
                month: 'long',
                day: 'numeric',
                weekday: 'long'
            });
            
            const dayTasks = tasks.filter(task => task.date === dateStr);
            const container = document.getElementById('daySchedule');
            
            if (dayTasks.length === 0) {
                container.innerHTML = '<p class="text-gray-500 text-center py-8">この日の予定はありません</p>';
                return;
            }
            
            // Sort tasks by time
            dayTasks.sort((a, b) => {
                if (!a.time && !b.time) return 0;
                if (!a.time) return 1;
                if (!b.time) return -1;
                return a.time.localeCompare(b.time);
            });
            
            container.innerHTML = dayTasks.map(task => `
                <div class="schedule-item ${task.completed ? 'completed' : ''}" onclick="toggleTaskComplete(${task.id})">
                    <div class="flex items-center justify-between">
                        <div class="flex items-center space-x-3">
                            <input type="checkbox" ${task.completed ? 'checked' : ''} class="rounded">
                            <div>
                                <h4 class="font-medium">${task.name}</h4>
                                ${task.description ? `<p class="text-sm text-gray-600">${task.description}</p>` : ''}
                            </div>
                        </div>
                        <div class="text-right">
                            <div class="text-sm font-medium">${task.time || '時間未設定'}</div>
                            <div class="flex space-x-1 mt-1">
                                <span class="px-2 py-1 text-xs rounded ${getImportanceBadge(task.importance)}">${getImportanceLabel(task.importance)}</span>
                                <span class="px-2 py-1 text-xs rounded ${getUrgencyBadge(task.urgency)}">${getUrgencyLabel(task.urgency)}</span>
                            </div>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        function updateWeekView() {
            const startOfWeek = new Date(currentDate);
            startOfWeek.setDate(currentDate.getDate() - currentDate.getDay());
            
            const endOfWeek = new Date(startOfWeek);
            endOfWeek.setDate(startOfWeek.getDate() + 6);
            
            document.getElementById('weekTitle').textContent = 
                startOfWeek.toLocaleDateString('ja-JP', { month: 'long', day: 'numeric' }) + 
                ' - ' + 
                endOfWeek.toLocaleDateString('ja-JP', { month: 'long', day: 'numeric' });
            
            const container = document.getElementById('weekSchedule');
            const days = ['日', '月', '火', '水', '木', '金', '土'];
            
            container.innerHTML = days.map((day, index) => {
                const date = new Date(startOfWeek);
                date.setDate(startOfWeek.getDate() + index);
                const dateStr = date.toISOString().split('T')[0];
                const dayTasks = tasks.filter(task => task.date === dateStr);
                
                return `
                    <div class="bg-white p-3 rounded-lg shadow-sm border">
                        <h3 class="font-medium text-center mb-2">${day}</h3>
                        <div class="text-center text-sm text-gray-600 mb-2">${date.getDate()}</div>
                        <div class="space-y-1">
                            ${dayTasks.map(task => `
                                <div class="text-xs p-1 rounded ${task.completed ? 'bg-green-100 text-green-800' : 'bg-blue-100 text-blue-800'}">
                                    ${task.time ? task.time + ' ' : ''}${task.name}
                                </div>
                            `).join('')}
                        </div>
                    </div>
                `;
            }).join('');
        }

        function updateMonthView() {
            const year = currentDate.getFullYear();
            const month = currentDate.getMonth();
            
            document.getElementById('monthTitle').textContent = currentDate.toLocaleDateString('ja-JP', {
                year: 'numeric',
                month: 'long'
            });
            
            const firstDay = new Date(year, month, 1);
            const lastDay = new Date(year, month + 1, 0);
            const startDate = new Date(firstDay);
            startDate.setDate(startDate.getDate() - firstDay.getDay());
            
            const calendar = document.getElementById('monthCalendar');
            let html = '';
            
            for (let i = 0; i < 42; i++) {
                const date = new Date(startDate);
                date.setDate(startDate.getDate() + i);
                const dateStr = date.toISOString().split('T')[0];
                const dayTasks = tasks.filter(task => task.date === dateStr);
                
                const isCurrentMonth = date.getMonth() === month;
                const isToday = date.toDateString() === new Date().toDateString();
                
                html += `
                    <div class="calendar-day ${!isCurrentMonth ? 'other-month' : ''} ${isToday ? 'today' : ''}">
                        <div class="text-sm font-medium">${date.getDate()}</div>
                        <div class="mt-1">
                            ${dayTasks.slice(0, 3).map(task => `
                                <div class="text-xs p-1 mb-1 rounded ${task.completed ? 'bg-green-100 text-green-800' : 'bg-blue-100 text-blue-800'}">
                                    ${task.name}
                                </div>
                            `).join('')}
                            ${dayTasks.length > 3 ? `<div class="text-xs text-gray-500">+${dayTasks.length - 3} more</div>` : ''}
                        </div>
                    </div>
                `;
            }
            
            calendar.innerHTML = html;
        }

        function updateYearView() {
            const year = currentDate.getFullYear();
            document.getElementById('yearTitle').textContent = year + '年';
            
            const container = document.getElementById('yearCalendar');
            const months = ['1月', '2月', '3月', '4月', '5月', '6月', '7月', '8月', '9月', '10月', '11月', '12月'];
            
            container.innerHTML = months.map((monthName, monthIndex) => {
                const firstDay = new Date(year, monthIndex, 1);
                const lastDay = new Date(year, monthIndex + 1, 0);
                const startDate = new Date(firstDay);
                startDate.setDate(startDate.getDate() - firstDay.getDay());
                
                let monthHtml = '';
                for (let i = 0; i < 42; i++) {
                    const date = new Date(startDate);
                    date.setDate(startDate.getDate() + i);
                    const dateStr = date.toISOString().split('T')[0];
                    const dayTasks = tasks.filter(task => task.date === dateStr);
                    
                    const isCurrentMonth = date.getMonth() === monthIndex;
                    if (isCurrentMonth) {
                        monthHtml += `
                            <div class="year-calendar-day ${dayTasks.length > 0 ? 'has-task' : ''}">
                                ${date.getDate()}
                            </div>
                        `;
                    } else {
                        monthHtml += '<div class="year-calendar-day"></div>';
                    }
                }
                
                return `
                    <div class="year-month">
                        <div class="year-month-header">${monthName}</div>
                        <div class="year-calendar-grid">
                            <div class="text-xs text-gray-500">日</div>
                            <div class="text-xs text-gray-500">月</div>
                            <div class="text-xs text-gray-500">火</div>
                            <div class="text-xs text-gray-500">水</div>
                            <div class="text-xs text-gray-500">木</div>
                            <div class="text-xs text-gray-500">金</div>
                            <div class="text-xs text-gray-500">土</div>
                            ${monthHtml}
                        </div>
                        <div class="text-xs text-gray-500 mt-2">
                            タスク数: ${tasks.filter(task => task.date && task.date.startsWith(`${year}-${String(monthIndex + 1).padStart(2, '0')}`)).length}
                        </div>
                    </div>
                `;
            }).join('');
        }

        // Navigation functions
        function previousDay() {
            currentDate.setDate(currentDate.getDate() - 1);
            updateDayView();
        }

        function nextDay() {
            currentDate.setDate(currentDate.getDate() + 1);
            updateDayView();
        }

        function previousWeek() {
            currentDate.setDate(currentDate.getDate() - 7);
            updateWeekView();
        }

        function nextWeek() {
            currentDate.setDate(currentDate.getDate() + 7);
            updateWeekView();
        }

        function previousMonth() {
            currentDate.setMonth(currentDate.getMonth() - 1);
            updateMonthView();
        }

        function nextMonth() {
            currentDate.setMonth(currentDate.getMonth() + 1);
            updateMonthView();
        }

        function previousYear() {
            currentDate.setFullYear(currentDate.getFullYear() - 1);
            updateYearView();
        }

        function nextYear() {
            currentDate.setFullYear(currentDate.getFullYear() + 1);
            updateYearView();
        }

        // Pomodoro functions
        function startPomodoro() {
            if (!pomodoroActive) {
                pomodoroActive = true;
                pomodoroTimer = setInterval(updatePomodoroTimer, 1000);
                document.getElementById('pomodoroStart').disabled = true;
                document.getElementById('pomodoroPause').disabled = false;
            }
        }

        function pausePomodoro() {
            if (pomodoroActive) {
                pomodoroActive = false;
                clearInterval(pomodoroTimer);
                document.getElementById('pomodoroStart').disabled = false;
                document.getElementById('pomodoroPause').disabled = true;
            }
        }

        function resetPomodoro() {
            pomodoroActive = false;
            clearInterval(pomodoroTimer);
            pomodoroTimeLeft = 25 * 60;
            updatePomodoroDisplay();
            document.getElementById('pomodoroStart').disabled = false;
            document.getElementById('pomodoroPause').disabled = true;
        }

        function updatePomodoroTimer() {
            if (pomodoroTimeLeft > 0) {
                pomodoroTimeLeft--;
                updatePomodoroDisplay();
            } else {
                // Pomodoro completed
                pomodoroActive = false;
                clearInterval(pomodoroTimer);
                pomodoroStats.completedCycles++;
                pomodoroStats.focusTime += 25;
                savePomodoroStats();
                updatePomodoroStats();
                showNotification('ポモドーロ完了！5分間休憩してください', 'success');
                resetPomodoro();
            }
        }

        function updatePomodoroDisplay() {
            const minutes = Math.floor(pomodoroTimeLeft / 60);
            const seconds = pomodoroTimeLeft % 60;
            document.getElementById('pomodoroDisplay').textContent = 
                `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
            
            // Update circle
            const totalTime = 25 * 60;
            const progress = (totalTime - pomodoroTimeLeft) / totalTime;
            const circumference = 565.48;
            const offset = circumference * (1 - progress);
            document.getElementById('pomodoroCircle').style.strokeDashoffset = offset;
        }

        function updatePomodoroStats() {
            document.getElementById('completedCycles').textContent = pomodoroStats.completedCycles;
            document.getElementById('focusTime').textContent = pomodoroStats.focusTime;
        }

        function savePomodoroStats() {
            localStorage.setItem('pomodoroStats', JSON.stringify(pomodoroStats));
        }

        // Export functions
        function exportCSV() {
            const csvContent = [
                ['Subject', 'Start Date', 'Start Time', 'End Date', 'End Time', 'Description', 'Location'],
                ...tasks.map(task => [
                    task.name,
                    task.date || '',
                    task.time || '',
                    task.date || '',
                    task.time ? addMinutes(task.time, 60) : '',
                    task.description || '',
                    ''
                ])
            ].map(row => row.map(field => `"${field}"`).join(',')).join('\n');
            
            downloadFile(csvContent, 'tasks.csv', 'text/csv');
            showNotification('CSVファイルをダウンロードしました', 'success');
        }

        function exportICS() {
            const icsContent = [
                'BEGIN:VCALENDAR',
                'VERSION:2.0',
                'PRODID:-//Smart Task Manager//Task Manager//EN',
                'CALSCALE:GREGORIAN',
                ...tasks.map(task => [
                    'BEGIN:VEVENT',
                    `UID:${task.id}@smart-task-manager`,
                    `DTSTART:${formatDateForICS(task.date, task.time)}`,
                    `DTEND:${formatDateForICS(task.date, task.time, 60)}`,
                    `SUMMARY:${task.name}`,
                    `DESCRIPTION:${task.description || ''}`,
                    `PRIORITY:${task.importance === 'high' ? '1' : task.importance === 'medium' ? '5' : '9'}`,
                    'END:VEVENT'
                ]).flat(),
                'END:VCALENDAR'
            ].join('\r\n');
            
            downloadFile(icsContent, 'tasks.ics', 'text/calendar');
            showNotification('ICSファイルをダウンロードしました', 'success');
        }

        // Helper functions
        function addMinutes(time, minutes) {
            if (!time) return '';
            const [hours, mins] = time.split(':').map(Number);
            const totalMinutes = hours * 60 + mins + minutes;
            const newHours = Math.floor(totalMinutes / 60) % 24;
            const newMins = totalMinutes % 60;
            return `${newHours.toString().padStart(2, '0')}:${newMins.toString().padStart(2, '0')}`;
        }

        function formatDateForICS(date, time, addMinutes = 0) {
            if (!date) return '';
            const d = new Date(date);
            if (time) {
                const [hours, minutes] = time.split(':').map(Number);
                d.setHours(hours, minutes + addMinutes);
            }
            return d.toISOString().replace(/[-:]/g, '').replace(/\.\d{3}/, '');
        }

        function downloadFile(content, filename, contentType) {
            const blob = new Blob([content], { type: contentType });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = filename;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }

        function getPriorityClass(importance) {
            switch (importance) {
                case 'high': return 'priority-high';
                case 'medium': return 'priority-medium';
                case 'low': return 'priority-low';
                default: return 'priority-medium';
            }
        }

        function getUrgencyClass(urgency) {
            switch (urgency) {
                case 'high': return 'urgency-high';
                case 'medium': return 'urgency-medium';
                case 'low': return 'urgency-low';
                default: return 'urgency-medium';
            }
        }

        function getImportanceBadge(importance) {
            switch (importance) {
                case 'high': return 'bg-red-100 text-red-800';
                case 'medium': return 'bg-yellow-100 text-yellow-800';
                case 'low': return 'bg-green-100 text-green-800';
                default: return 'bg-gray-100 text-gray-800';
            }
        }

        function getUrgencyBadge(urgency) {
            switch (urgency) {
                case 'high': return 'bg-red-100 text-red-800';
                case 'medium': return 'bg-yellow-100 text-yellow-800';
                case 'low': return 'bg-green-100 text-green-800';
                default: return 'bg-gray-100 text-gray-800';
            }
        }

        function getImportanceLabel(importance) {
            switch (importance) {
                case 'high': return '重要';
                case 'medium': return '中';
                case 'low': return '低';
                default: return '中';
            }
        }

        function getUrgencyLabel(urgency) {
            switch (urgency) {
                case 'high': return '緊急';
                case 'medium': return '中';
                case 'low': return '低';
                default: return '中';
            }
        }

        function showNotification(message, type = 'info') {
            const notification = document.createElement('div');
            notification.className = `fixed top-4 right-4 p-4 rounded-lg shadow-lg z-50 ${
                type === 'success' ? 'bg-green-500 text-white' :
                type === 'error' ? 'bg-red-500 text-white' :
                'bg-blue-500 text-white'
            }`;
            notification.textContent = message;
            
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.remove();
            }, 3000);
        }

        // Initialize display
        updatePomodoroDisplay();
    </script>
<script defer src="https://static.cloudflareinsights.com/beacon.min.js/vcd15cbe7772f49c399c6a5babf22c1241717689176015" integrity="sha512-ZpsOmlRQV6y907TI0dKBHq9Md29nnaEIPlkf84rnaERnq6zvWvPUqr2ft8M1aS28oN72PdrCzSjY4U6VaAw1EQ==" data-cf-beacon='{"rayId":"95ee949afd70d5c8","serverTiming":{"name":{"cfExtPri":true,"cfEdge":true,"cfOrigin":true,"cfL4":true,"cfSpeedBrain":true,"cfCacheStatus":true}},"version":"2025.6.2","token":"4edd5f8ec12a48cfa682ab8261b80a79"}' crossorigin="anonymous"></script>
</body>
</html>
    <script id="html_badge_script1">
        window.__genspark_remove_badge_link = "https://www.genspark.ai/api/html_badge/" +
            "remove_badge?token=To%2FBnjzloZ3UfQdcSaYfDidHBInkFGUtSYiWEHAwl2gRsNYHz2RIF6yzChmbwHs8qHshTJAngyqK5obLUFRCY96Aflmxo7Q8tqrXMfEk%2F1VfzRfNrr0IKoYpKtlK9aBZbAj8QQYLwDhnAjybof1F0okOIb1rFAUW9wIDGth8jcY2YgRv9emUODYSg0WBGMqpQQgV%2F9boFn1ylQRmD3a1IgJUdc0FXvU4eU9TbOb13d34ta7%2BSR%2FLZpfYDMhDKS0pOhojI8XQ%2FtSRIsf2epEgnMEiV6wpHLVbxqp4Zc%2Bpin602DIE0MDtfeVDD%2BKr4R7Eerk7wCaORCJ3iCYLp4JCVr%2BkkhhHcbp37U7PZBhHmCuu1dvlBV4mtR98aps2ji2Znt%2FbyayNrLMpD5wPY7c%2B%2Fi4UxLVh1HKzOz0cjnGLq3ifmC37x0c5cQ%2FP8WGTy0DVcMMURq0XNk%2BgxCa1gMg8WLmGxSn8bRC6lqqsI%2FWkAtvxr2%2Fv%2FPPEAkQICMqCYS9tfSSdnwPV1f8kz0lstP8YyD55O0Xms%2FbugRaLd%2BzKNAo%3D";
        window.__genspark_locale = "ja-JP";
        window.__genspark_token = "To/BnjzloZ3UfQdcSaYfDidHBInkFGUtSYiWEHAwl2gRsNYHz2RIF6yzChmbwHs8qHshTJAngyqK5obLUFRCY96Aflmxo7Q8tqrXMfEk/1VfzRfNrr0IKoYpKtlK9aBZbAj8QQYLwDhnAjybof1F0okOIb1rFAUW9wIDGth8jcY2YgRv9emUODYSg0WBGMqpQQgV/9boFn1ylQRmD3a1IgJUdc0FXvU4eU9TbOb13d34ta7+SR/LZpfYDMhDKS0pOhojI8XQ/tSRIsf2epEgnMEiV6wpHLVbxqp4Zc+pin602DIE0MDtfeVDD+Kr4R7Eerk7wCaORCJ3iCYLp4JCVr+kkhhHcbp37U7PZBhHmCuu1dvlBV4mtR98aps2ji2Znt/byayNrLMpD5wPY7c+/i4UxLVh1HKzOz0cjnGLq3ifmC37x0c5cQ/P8WGTy0DVcMMURq0XNk+gxCa1gMg8WLmGxSn8bRC6lqqsI/WkAtvxr2/v/PPEAkQICMqCYS9tfSSdnwPV1f8kz0lstP8YyD55O0Xms/bugRaLd+zKNAo=";
    </script>
    
    <script id="html_notice_dialog_script" src="https://www.genspark.ai/notice_dialog.js"></script>
    